"use strict";angular.module("angularFungiorbisApp",["ngAnimate","ui.router","ui.bootstrap","ngCookies","ngResource","xeditable","mgcrea.ngStrap","public","dashboard","navigation.userToolbar","services.authentication","services.icons","services.habitats","services.substrates","services.i18n","services.util","resources.users","resources.species","resources.references","resources.characteristics","directives.alert","directives.icon","directives.tableWithPagination","directives.newHabitat","directives.descriptionEdit","directives.usability","directives.usabilityPublic","directives.typeahead","directives.substratesSelect","directives.helpText","directives.characteristicEdit","directives.characteristicPreview","directives.characteristicsTable","directives.systematicsTypeAhead"]).constant("SERVER_BASE_URL","http://178.79.152.32/api").config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.headers.common["Content-Type"]="application/json",a.defaults.headers.common.Accept="application/json",delete a.defaults.headers.common["X-Requested-With"]}]).run(["$http","authentication",function(a,b){var c=b.currentUser;c&&(a.defaults.headers.common["X-User-Email"]=c.email,a.defaults.headers.common["X-User-Token"]=c.authToken)}]).run(["$rootScope","$state","authentication",function(a,b,c){a.$on("$stateChangeStart",function(a,d){angular.isDefined(d.data)&&d.data.authenticate&&!c.isSupervisor()&&(b.go("home"),a.preventDefault())})}]).run(["editableOptions",function(a){a.theme="bs3"}]),angular.module("public",["public.species","public.specimens"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.html5Mode(!0),b.otherwise("/"),a.state("home",{url:"/",templateUrl:"app/home.tpl.html",controller:"HomeController as homeCtrl",resolve:{statsResponse:["Species",function(a){return a.stats("home")}]}})}]).controller("HomeController",["statsResponse",function(a){this.stats=a.data.stats}]).controller("NavigationController",["authentication",function(a){this.activeTab="home",this.hasAccess=a.hasAccess,this.publicItems=[{name:"species",text:"Vrste"},{name:"specimens",text:"Nalazi"}],this.isActiveTab=function(a){return a===this.activeTab},this.setActiveTab=function(a){this.activeTab=a}}]),angular.module("public.species",[]).config(["$stateProvider",function(a){a.state("species",{url:"^/species",templateUrl:"/app/public/species-index.tpl.html",controller:"PublicSpeciesController as speciesCtrl",resolve:{statsResponse:["Species",function(a){return a.stats("species")}],preloadHabitats:["Habitats",function(a){return a.load()}],preloadSubstrates:["Substrates",function(a){return a.load()}]}}).state("species/detail",{url:"^/species/:speciesId",templateUrl:"/app/public/species-show.tpl.html",controller:"ASpeciesController as speciesCtrl",resolve:{}})}]).controller("PublicSpeciesController",["$scope","$state","Species","Characteristics","Habitats","Substrates","statsResponse",function(a,b,c,d,e,f,g){a.searchParams={},a.appendHabitats=function(b){a.searchParams.habitats=b},a.stats=g.data.stats,a.$watch("searchParams",function(b,f){if(angular.isDefined(f)&&angular.isDefined(b)){var g;a.displayParams=[],angular.isDefined(b.systematics)&&b.systematics.length>0&&(g=g||{},g[b.systematicsCategory]=b.systematics,a.displayParams.push(b.systematics)),angular.isDefined(b.habitats)&&b.habitats.length>0&&(g=g||{},g.habitats="",b.habitats.forEach(function(b){a.displayParams.push(e.toString(b,"localized")),g.habitats+=e.toString(b)+","})),angular.isDefined(b.substrates)&&b.substrates.length>0&&(g=g||{},g.substrates=b.substrates.join(","),a.displayParams.push(b.substrates.join(", "))),angular.isDefined(b.nutritiveGroup)&&b.nutritiveGroup.length>0&&(g=g||{},g.nutritiveGroup=b.nutritiveGroup,a.displayParams.push(b.nutritiveGroup)),angular.isArray(b.usabilities)&&b.usabilities.length>0&&(g=g||{},b.usabilities.forEach(function(b){g["characteristics."+b]=!0,a.displayParams.push(d.translateUsability(b))})),g?(g.include="characteristics",c.index(g).then(function(b){a.species=b.data.species,a.characteristics={},a.species.forEach(function(b){a.characteristics[b.id]=a.displayCharacteristics(b)}),a.totalHits=b.data.meta.species.count+" pogodaka"})):a.species=void 0,a.displayParams=a.displayParams.join("; ")}},!0),a.displayCharacteristics=function(a){var b={usabilities:[],habitats:[],substrates:[],nutritiveGroup:"nutritivna grupa: "+a.nutritiveGroup,growthType:null===a.growthType?void 0:"način rasta: "+a.growthType,sections:{}};return angular.isDefined(a)&&a.characteristics.forEach(function(a){d.usabilitiesArray().forEach(function(c){a[c]&&b.usabilities.push(c)}),angular.isArray(a.habitats)&&a.habitats.length>0&&a.habitats.forEach(function(a){var c,d,f=Object.keys(a)[0];c=angular.isDefined(a[f].subhabitat)?e.translateSubhabitat(f,a[f].subhabitat):e.translateHabitat(f),angular.isArray(a[f].species)&&(d=a[f].species.join(", ")),b.habitats.push({key:f,title:c,species:d})}),angular.isArray(a.substrates)&&a.substrates.length>0&&a.substrates.forEach(function(a){b.substrates.push({key:a,title:f.translateSubstrate(a)})}),["fruitingBody","microscopy","flesh","chemistry","notes"].forEach(function(c){a[c]&&a[c].sr.length>0&&(b.sections[c]={key:c,title:d.translateSection(c),content:a[c].sr})})}),b},a.nutritiveGroups=c.nutritiveGroupsHash(),a.reset=function(){a.species=void 0,a.searchParams={systematicsCategory:"genus",habitats:[],substrates:[],usabilities:[]},a.resetUsabilities()},a.translateUsability=d.translateUsability}]).controller("ASpeciesController",["$scope","$timeout","$state","$modal","$filter","speciesResponse","characteristicComponent","Characteristics","Species","References",function(){}]),angular.module("public.specimens",[]).config(["$stateProvider",function(a){a.state("specimens",{url:"^/specimens",templateUrl:"/app/public/specimens-index.tpl.html",controller:"PublicSpecimensController as specimensCtrl",resolve:{statsResponse:["Species",function(a){return a.stats("specimens")}],preloadHabitats:["Habitats",function(a){return a.load()}],preloadSubstrates:["Substrates",function(a){return a.load()}]}}).state("specimens/detail",{url:"^/specimens/:specimensId",templateUrl:"/app/public/specimens-show.tpl.html",controller:"PublicSpecimenController as specimensCtrl",resolve:{}})}]).controller("PublicSpecimensController",["$scope","$state","Species","Characteristics","Habitats","Substrates","statsResponse",function(a,b,c,d,e,f,g){a.searchParams={},a.appendHabitats=function(b){a.searchParams.habitats=b},a.stats=g.data.stats,a.displayCharacteristics=function(a){var b={usabilities:[],habitats:[],substrates:[],nutritiveGroup:"nutritivna grupa: "+a.nutritiveGroup,growthType:null===a.growthType?void 0:"način rasta: "+a.growthType,sections:{}};return angular.isDefined(a)&&a.characteristics.forEach(function(a){d.usabilitiesArray().forEach(function(c){a[c]&&b.usabilities.push(c)}),angular.isArray(a.habitats)&&a.habitats.length>0&&a.habitats.forEach(function(a){var c,d,f=Object.keys(a)[0];c=angular.isDefined(a[f].subhabitat)?e.translateSubhabitat(f,a[f].subhabitat):e.translateHabitat(f),angular.isArray(a[f].species)&&(d=a[f].species.join(", ")),b.habitats.push({key:f,title:c,species:d})}),angular.isArray(a.substrates)&&a.substrates.length>0&&a.substrates.forEach(function(a){b.substrates.push({key:a,title:f.translateSubstrate(a)})}),["fruitingBody","microscopy","flesh","chemistry","notes"].forEach(function(c){a[c]&&a[c].sr.length>0&&(b.sections[c]={key:c,title:d.translateSection(c),content:a[c].sr})})}),b},a.nutritiveGroups=c.nutritiveGroupsHash(),a.reset=function(){a.species=void 0,a.searchParams={systematicsCategory:"genus",habitats:[],substrates:[],usabilities:[]},a.resetUsabilities()},a.translateUsability=d.translateUsability}]),angular.module("dashboard",["dashboard.stats","dashboard.users","dashboard.species","dashboard.references"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/dashboard","/dashboard/activity"),a.state("dashboard",{url:"/dashboard",templateUrl:"/app/dashboard/dashboard.tpl.html",controller:"DashboardController as dashboardNav",data:{authenticate:!0}}).state("dashboard.activity",{url:"/activity",templateUrl:"/app/dashboard/activity.tpl.html"})}]).controller("DashboardController",function(){this.activityCollapsed=!1,this.activeTab="activity",this.toggleActivity=function(){"activity"===this.activeTab?this.activityCollapsed=!this.activityCollapsed:this.activeTab="activity"},this.isActiveTab=function(a){return this.activeTab===a},this.setActiveTab=function(a){this.activeTab=a},this.activityItems=[{name:"users",text:"Users"},{name:"species",text:"Species"},{name:"specimens",text:"Specimens"},{name:"references",text:"References"}]}),angular.module("dashboard.users",[]).config(["$stateProvider",function(a){a.state("dashboard.users",{url:"^/dashboard/users",templateUrl:"/app/dashboard/users-index.tpl.html",controller:"UsersController as usersCtrl",resolve:{usersResponse:["Users",function(a){return a.index({sort:"role"})}]}})}]).controller("UsersController",["$scope","$state","usersResponse","Users",function(a,b,c,d){var e=this,f=c.data.users,g=c.data.meta;this.tableParams={prefix:"users",data:f,columns:d.fields(),meta:g.users,sort:"role",editUrl:b.current.url,paginatorPages:10,getData:function(a){d.index(a).success(function(a){e.tableParams.meta=a.meta.users,e.tableParams.data=a.users})}}}]),angular.module("dashboard.species",[]).config(["$stateProvider",function(a){a.state("dashboard.species",{url:"^/dashboard/species",templateUrl:"/app/dashboard/species-index.tpl.html",controller:"SpeciesController as speciesCtrl",resolve:{speciesResponse:["Species",function(a){return a.index()}]}}).state("dashboard.species/new",{url:"^/dashboard/species/new",templateUrl:"/app/dashboard/species-show.tpl.html",controller:"NewSpeciesController as speciesCtrl"}).state("dashboard.species/detail",{url:"^/dashboard/species/:speciesId",templateUrl:"/app/dashboard/species-show.tpl.html",controller:"ASpeciesController as speciesCtrl",resolve:{speciesResponse:["Species","$stateParams",function(a,b){return a.show(b.speciesId)}],preloadHabitats:["Habitats",function(a){return a.load()}],preloadSubstrates:["Substrates",function(a){return a.load()}]}})}]).controller("SpeciesController",["$scope","$state","speciesResponse","Species",function(a,b,c,d){var e=this,f=c.data.species,g=c.data.meta;this.tableParams={createNewLabel:"Create new Species",prefix:"species",data:f,columns:d.fields(),meta:g.species,sort:"fullName",editUrl:b.current.url,paginatorPages:10,getData:function(a){d.index(a).success(function(a){e.tableParams.meta=a.meta.species,e.tableParams.data=a.species})},removeRow:function(a){return d.delete({id:a})}}}]).controller("NewSpeciesController",["$scope","$state","$filter","Util","Species",function(a,b,c,d,e){var f=this,g=[],h={};f.context="create",f.pageTitle="Create new species",f.createSpecies=function(){e.save({data:a.species}).success(function(a,c,d){var e=d("Location").split("/");b.go("dashboard.species/detail",{speciesId:e[e.length-1]})})},a.species={},a.systematics=e.systematics(),a.growthTypes=e.growthTypes(),a.nutritiveGroups=e.nutritiveGroups(),a.showGrowthType=function(){var b=c("filter")(a.growthTypes,{value:a.species.growthType});return a.species.growthType&&b.length?b[0].text:"Not set"},a.showNutritiveGroup=function(){var b=c("filter")(a.nutritiveGroups,{value:a.species.nutritiveGroup});return a.species.nutritiveGroup&&b.length?b[0].text:"Not set"},angular.forEach(a.systematics,function(a){g.push(a.field)}),a.$watch("species",function(a){d.cleanParams(a),0===Object.keys(a).length?(f.speciesIsEmpty=!0,f.missingFields=g):(f.speciesIsEmpty=!1,f.missingFields=d.arrayDifference(g,Object.keys(a)),a.name&&a.genus&&(h.name!==a.name||h.genus!==a.genus)?e.index({name:a.name,genus:a.genus,fields:"name,genus"}).then(function(b){var c=b.data.species;1===c.length?(f.nameGenusTaken=!0,f.speciesFullName=a.genus+" "+a.name,f.matchingSpeciesId=c[0].id):f.nameGenusTaken=!1,h.name=a.name,h.genus=a.genus,f.readyToSave=!f.nameGenusTaken&&0===f.missingFields.length}):f.readyToSave=!f.nameGenusTaken&&0===f.missingFields.length)},!0)}]).controller("ASpeciesController",["$scope","$timeout","$state","$modal","$filter","speciesResponse","characteristicComponent","Characteristics","Species","References",function(a,b,c,d,e,f,g,h,i,j){var k=this,l=f.data.species;k.context="edit",k.pageTitle=l.genus+" "+l.name,a.species=l,a.systematics=i.systematics(),a.growthTypes=i.growthTypes(),a.nutritiveGroups=i.nutritiveGroups(),a.showGrowthType=function(){var b=e("filter")(a.growthTypes,{value:a.species.growthType});return a.species.growthType&&b.length?b[0].text:"Not set"},a.showNutritiveGroup=function(){var b=e("filter")(a.nutritiveGroups,{value:a.species.nutritiveGroup});return a.species.nutritiveGroup&&b.length?b[0].text:"Not set"},k.updateField=function(a,b){var c={id:l.id};return c[a]=b,i.save({data:c,url:f.data.links.species}).then(function(){},function(a){return a.data.errors.details[0]})},a.$watch("referenceId",function(b){angular.isDefined(b)&&h.get({speciesId:l.id,referenceId:b}).success(function(c,d,e,f){a.characteristic=angular.isDefined(c.characteristics[0])?c.characteristics[0]:{referenceId:b,speciesId:l.id},g.initialize(a.characteristic.id,a.characteristic,f.url)})}),a.$watch("referenceFullTitle",function(b){a.referenceId&&(angular.isUndefined(b)||0===b.length)&&k.reset(!0)}),a.$watch("characteristic",function(b,c){angular.isDefined(c)&&angular.isDefined(b)&&(a.dirty=g.trackChanges(b)),a.emptyParams=g.emptyParams(b)},!0),a.missingCharacteristics=g.missingCharacteristics(l.characteristics),k.saveCharacteristic=function(){g.saveCharacteristic(a.characteristic).then(function(c){angular.isDefined(a.characteristic.id)?a.species.characteristics[a.characteristicRow.currentIndex]=c:a.species.characteristics.push(c),a.missingCharacteristics=g.missingCharacteristics(a.species.characteristics),k.resetCharacteristic(),b(function(){a.characteristicRow.show()},1),a.resetDialog.hide()})},k.resetCharacteristic=function(){k.reset(),a.characteristic=void 0},k.reset=function(b){a.dirty=!1,a.emptyParams=!1,a.referenceId=void 0,angular.isUndefined(b)&&(a.referenceFullTitle=void 0),g.reset(a.characteristic)},a.resetDialog={modal:d({scope:a,template:"common/templates/modal-reset.tpl.html",show:!1}),title:function(){return angular.isDefined(a.referenceFullTitle)?a.referenceFullTitle:angular.isDefined(a.characteristic)&&angular.isDefined(a.characteristic.reference)?a.characteristic.reference.fullTitle:void 0},subtitle:function(){return a.species.fullName},hide:function(){this.modal.hide()},show:function(){this.modal.show()},save:function(){k.saveCharacteristic(),this.modal.hide()},reset:function(){k.reset(),a.characteristic=void 0,this.modal.hide(),b(function(){a.characteristicRow.show()},1)},close:function(){this.hide()}},a.deleteDialog={modal:d({scope:a,template:"common/templates/modal-delete.tpl.html",show:!1}),title:function(){return angular.isDefined(a.characteristic)&&angular.isDefined(a.characteristic.reference)?a.characteristic.reference.fullTitle:void 0},subtitle:function(){return a.species.fullName},hide:function(){this.modal.hide()},show:function(){this.modal.show()},destroy:function(){var b=this;h.httpDelete(g.getAttrs(a.characteristic)).success(function(){i.show(a.species.id).success(function(c){b.hide(),k.reset(),a.characteristic=void 0,a.missingCharacteristics=g.missingCharacteristics(l.characteristics),a.species.characteristics=c.species.characteristics})})}},k.deleteSpecies=function(){i.delete({id:a.species.id}).success(function(){c.go("dashboard.species")})},k.typeAheadProperties={icon:"references",key:"fullTitle",placeholder:"To add or edit characteristic type in the reference title or author name",getData:function(a){return j.index({filterTarget:"authors,title",fields:"id,fullTitle",filterValue:a}).then(function(a){return a.data.references})}}}]),angular.module("dashboard.references",[]).config(["$stateProvider",function(a){a.state("dashboard.references",{url:"^/dashboard/references",templateUrl:"/app/dashboard/references-index.tpl.html",controller:"ReferencesController as referencesCtrl",resolve:{referencesResponse:["References",function(a){return a.index()}]}}).state("dashboard.references/new",{url:"^/dashboard/references/new",templateUrl:"/app/dashboard/references-show.tpl.html",controller:"NewReferenceController as referenceCtrl"}).state("dashboard.references/detail",{url:"^/dashboard/references/:referenceId",templateUrl:"/app/dashboard/references-show.tpl.html",controller:"ReferenceController as referenceCtrl",resolve:{referenceResponse:["References","$stateParams",function(a,b){return a.show(b.referenceId)}],preloadHabitats:["Habitats",function(a){return a.load()}],preloadSubstrates:["Substrates",function(a){return a.load()}]}})}]).controller("ReferencesController",["$scope","$state","referencesResponse","References",function(a,b,c,d){var e=this,f=c.data.references,g=c.data.meta;this.tableParams={createNewLabel:"Create new Reference",prefix:"references",data:f,columns:d.fields(),meta:g.references,sort:"authors",editUrl:b.current.url,paginatorPages:10,getData:function(a){d.index(a).success(function(a){e.tableParams.meta=a.meta.references,e.tableParams.data=a.references})},removeRow:function(a){return d.delete({id:a})}}}]).controller("NewReferenceController",["$scope","$state","References","Util",function(a,b,c,d){var e=this,f=["title"],g={};e.context="create",e.pageTitle="Create new reference",e.createReference=function(){c.save({data:a.reference}).success(function(a,c,d){var e=d("Location").split("/");b.go("dashboard.references/detail",{referenceId:e[e.length-1]})})},a.reference={},e.fields=c.fields(),a.$watch("reference",function(a){d.cleanParams(a),0===Object.keys(a).length?(e.referenceIsEmpty=!0,e.missingFields=f):(e.referenceIsEmpty=!1,e.missingFields=d.arrayDifference(f,Object.keys(a)),a.url&&g.url!==a.url?c.index({url:a.url,fields:"fullTitle,url"}).then(function(b){var c=b.data.references;1===c.length?(e.urlTaken=!0,e.referenceFullTitle=c.fullTitle,e.matchingUrlId=c[0].id):e.urlTaken=!1,g.url=a.url,e.readyToSave=!e.isbnTaken&&!e.urlTaken&&0===e.missingFields.length}):e.readyToSave=!e.isbnTaken&&!e.urlTaken&&0===e.missingFields.length,a.url&&g.isbn!==a.isbn?c.index({isbn:a.isbn,fields:"fullTitle,isbn"}).then(function(b){var c=b.data.references;1===c.length?(e.isbnTaken=!0,e.referenceFullTitle=c.fullTitle,e.matchingIsbnId=c[0].id):e.isbnTaken=!1,g.isbn=a.isbn,e.readyToSave=!e.isbnTaken&&!e.urlTaken&&0===e.missingFields.length}):e.readyToSave=!e.isbnTaken&&!e.urlTaken&&0===e.missingFields.length)},!0)}]).controller("ReferenceController",["$scope","$timeout","$state","$modal","referenceResponse","characteristicComponent","Characteristics","References","Species",function(a,b,c,d,e,f,g,h,i){var j=this,k=e.data.references,l={referenceId:k.id};j.context="edit",j.pageTitle=k.authors?k.authors+" - ":"",j.pageTitle+=k.title,j.fields=h.fields(),a.reference=k,a.updateField=function(a,b){var c={id:k.id};return c[a]=b,h.save({data:c,url:e.data.links.references}).then(function(){},function(a){return a.data.errors.details[0]})},a.$watch("speciesId",function(b){angular.isDefined(b)&&g.get({speciesId:b,referenceId:k.id}).success(function(b,c,d,e){a.characteristic=angular.isDefined(b.characteristics[0])?b.characteristics[0]:angular.copy(l),f.initialize(a.characteristic.id,a.characteristic,e.url)})}),a.$watch("speciesFullName",function(b){a.speciesId&&(angular.isUndefined(b)||0===b.length)&&j.reset(!0)}),a.$watch("characteristic",function(b,c){angular.isDefined(c)&&angular.isDefined(b)&&(a.dirty=f.trackChanges(b)),a.emptyParams=f.emptyParams(b)},!0),j.saveCharacteristic=function(){f.saveCharacteristic(a.characteristic).then(function(c){angular.isDefined(a.characteristic.id)?a.reference.characteristics[a.characteristicRow.currentIndex]=c:a.reference.characteristics.push(c),j.resetCharacteristic(),b(function(){a.characteristicRow.show()},1),a.resetDialog.hide()})},j.resetCharacteristic=function(){j.reset(),a.characteristic=void 0},j.reset=function(b){a.dirty=!1,a.emptyParams=!1,a.speciesId=void 0,angular.isUndefined(b)&&(a.speciesFullName=void 0),f.reset(a.characteristic)},a.resetDialog={modal:d({scope:a,template:"common/templates/modal-reset.tpl.html",show:!1}),title:function(){return a.reference.fullTitle},subtitle:function(){return angular.isDefined(a.speciesFullName)?a.speciesFullName:angular.isDefined(a.characteristic)?a.characteristic.species.fullName:void 0},hide:function(){this.modal.hide()},show:function(){this.modal.show()},save:function(){j.saveCharacteristic()},reset:function(){j.reset(),a.characteristic=void 0,this.modal.hide(),b(function(){a.characteristicRow.show()},1)},close:function(){this.hide()}},a.deleteDialog={modal:d({scope:a,template:"common/templates/modal-delete.tpl.html",show:!1}),title:function(){return a.reference.fullTitle},subtitle:function(){return angular.isDefined(a.characteristic)&&angular.isDefined(a.characteristic.species)?a.characteristic.species.fullName:void 0},hide:function(){this.modal.hide()},show:function(){this.modal.show()},destroy:function(){var b=this;g.httpDelete(f.getAttrs(a.characteristic)).success(function(){h.show(a.reference.id).success(function(c){b.hide(),j.reset(),a.characteristic=void 0,a.reference.characteristics=c.references.characteristics})})}},j.deleteReference=function(){h.delete({id:a.reference.id}).success(function(){c.go("dashboard.references")})},j.typeAheadProperties={icon:"species",key:"fullName",placeholder:"To add or edit characteristic type in the species name",getData:function(a){return i.index({filterTarget:"name,genus",fields:"id,fullName",filterValue:a}).then(function(a){return a.data.species})}}}]),angular.module("dashboard.stats",[]).config(["$stateProvider",function(a){a.state("dashboard.stats",{url:"/stats",templateUrl:"/app/dashboard/stats/stats.tpl.html"})}]),angular.module("navigation.userToolbar",[]).directive("foUserToolbar",["authentication","$state",function(a,b){return{templateUrl:"app/navigation/userToolbar.tpl.html",restrict:"E",replace:!0,scope:!0,link:function(c){c.isAuthenticated=a.isAuthenticated(),c.showSignIn=!1,c.$watch(function(){return a.currentUser},function(b){c.currentUser=b,a.isAuthenticated()&&(c.currentUser.displayName=b.firstName+" "+b.lastName)}),c.signIn=function(){a.signIn(this.email,this.password).then(function(){c.showSignIn=!1,c.isAuthenticated=!0},function(){c.showSignIn=!0,c.isAuthenticated=!1}).finally(function(){c.email=null,c.password=null})},c.signOut=function(){a.signOut().then(function(){c.isAuthenticated=!1,b.go("home")},function(){})},c.cancel=function(){c.email="",c.password=""}}}}]),angular.module("services.icons",[]).constant("ICONS",{undefined:"fa-question",species:"fa-book",systematics:"fa-sitemap",incontestableCharacteristics:"fa-bars",missingCharacteristics:"fa-exclamation",usability:"fa-money",edible:"fa-cutlery",cultivated:"fa-thumbs-o-up",poisonous:"fa-warning",medicinal:"fa-heart-o",habitat:"fa-tree",substrate:"fa-leaf",description:"fa-list-alt",fruitingBody:"fa-lemon-o",chemistry:"fa-flask",microscopy:"fa-search",flesh:"fa-asterisk",notes:"fa-pencil-square-o",specimens:"fa-tags",references:"fa-quote-left",dashboard:"fa-dashboard",activity:"fa-dashboard",stats:"fa-bar-chart-o",speciesStatistics:"fa-list",add:"fa-plus",close:"fa-close",remove:"fa-close","delete":"fa-trash-o",cancel:"fa-close",save:"fa-save",confirm:"fa-check",edit:"fa-edit",refresh:"fa-refresh",spinner:"fa-spinner fa-spin",helpText:"fa-info-circle",sortDown:"fa-chevron-down",sortUp:"fa-chevron-up",backHistory:"fa-reply",successAlert:"fa-check",dangerAlert:"fa-flash",infoAlert:"fa-info-circle",warningAlert:"fa-exclamation-triangle",bulletHabitatPublic:"fa-angle-right",location:"fa-globe",fieldStudy:"fa-car",user:"fa-user",users:"fa-users",register:"fa-pencil-square-o",support:"fa-envelope",signIn:"fa-sign-in",signOut:"fa-power-off"}).factory("icons",["ICONS",function(a){return{get:function(b){return void 0===a[b]&&(b="undefined"),a[b]}}}]),angular.module("services.authentication",[]).factory("authentication",["$http","$q","$cookieStore","SERVER_BASE_URL",function(a,b,c,d){function e(e,f){var g=b.defer();return a({url:d+"/users/sign_in",method:"POST",data:JSON.stringify({user:{email:e,password:f}}),headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(a){i=a.data.users,c.put("currentUser",i),g.resolve(i)},function(a){g.reject(a)}),g.promise}function f(){var e=b.defer();return a({url:d+"/users/sign_out",method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json","X-User-Email":i.email,"X-User-Token":i.authToken}}).then(function(a){e.resolve(a)},function(a){e.reject(a)}).finally(function(){i=null,c.remove("currentUser")}),e.promise}function g(a){if(void 0===a||""===a||"visitor"===a)return!0;if(null===i)return!1;switch(i.role){case void 0:return!1;case"user":return"user"===a;case"contributor":return"user"===a||"contributor"===a;case"supervisor":return!0}}function h(){i=c.get("currentUser")||null}var i;return h(),{signIn:e,signOut:f,currentUser:i,hasAccess:g,isAuthenticated:function(){return null!==i},isSupervisor:function(){return this.isAuthenticated()&&"supervisor"===i.role},isContributor:function(){return this.isAuthenticated()&&"contributor"===i.role}}}]),angular.module("services.habitats",[]).factory("Habitats",["$http","$q","SERVER_BASE_URL",function(a,b,c){function d(){if(void 0===m){var d=b.defer();return a({url:c+"/habitats",method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(a){m=a.data,d.resolve(m)},function(a){d.reject(a)})}return m}function e(a){var b,c=[];return angular.forEach(a,function(a,c){b=a||{},b.key=c,this.push(b)},c),c}function f(){return e(m.sr.habitats)}function g(a){return void 0===a?[]:e(m.sr.habitats[a].subhabitat)}function h(a){var b=[];return angular.forEach(a,function(a,b){this.push({key:b,value:a})},b),b}function i(a,b){var c,d=[];if(void 0===a&&void 0===b)return[];if(c=void 0===b?m.sr.habitats[a].allowed_species_groups:void 0===m.sr.habitats[a]||void 0===m.sr.habitats[a].subhabitat||void 0===m.sr.habitats[a].subhabitat[b]?[]:m.sr.habitats[a].subhabitat[b].allowed_species_groups)for(var e=0;e<c.length;e++)d=d.concat(h(m.sr.species[c[e]]));return d}function j(a,b){var c,d=Object.keys(a)[0];if(angular.isDefined(b)){if(c=k(d),a[d].subhabitat&&(c+=" - "+a[d].subhabitat.title),a[d].species){var e=[];a[d].species.forEach(function(a){e.push(a)}),c+=": "+e.join(", ")}}else c=d,a[d].subhabitat&&(c+="-"+a[d].subhabitat),a[d].species&&(c+=":"+a[d].species.sort().join(","));return c}function k(a){return m.sr.habitats[a].title}function l(a,b){return angular.isDefined(m.sr.habitats[a].subhabitat)&&angular.isDefined(m.sr.habitats[a].subhabitat[b])?m.sr.habitats[a].subhabitat[b].title:void 0}var m;return{load:d,habitats:f,translateHabitat:k,subhabitats:g,translateSubhabitat:l,species:i,toString:j}}]),angular.module("services.substrates",[]).factory("Substrates",["$http","$q","SERVER_BASE_URL",function(a,b,c){function d(){if(void 0===g){var d=b.defer();a({url:c+"/substrates",method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(a){g=a.data,d.resolve(g)},function(a){d.reject(a)})}return g}function e(){return g.sr.substrates}function f(a){return g.sr.substrates[a]}var g;return{load:d,substrates:e,translateSubstrate:f}}]),angular.module("services.i18n",[]).factory("FoI18n",function(){function a(){return[{key:"sr",title:"srpski"},{key:"en",title:"English"}]}return{localesArray:a}}),angular.module("services.util",[]).factory("Util",function(){function a(a){return k(a)||null===a}function b(a){return k(a)||e(a)&&a===!1}function c(a){return h(a)&&0===a.length}function d(a){return i(a)&&0===a.length}function e(a){return a===!0||a===!1}function f(e,f){Object.keys(e).forEach(function(g){(c(e[g])||d(e[g]))&&(e[g]=null),(j(f)&&f[g]===e[g]||a(e[g])&&(a(f)||a(f[g]))||e[g]===!1&&b(f[g]))&&delete e[g]})}function g(a,b){if(k(b)||!h(b))return a;var c,d=[],e=angular.copy(b);return a.forEach(function(a){c=!1,e.forEach(function(b,d){a===b&&(delete e[d],c=!0)}),c||d.push(a)}),d}var h=angular.isArray,i=angular.isString,j=angular.isDefined,k=angular.isUndefined;return{undefinedOrNull:a,isEmptyArray:c,isEmptyString:d,cleanParams:f,arrayDifference:g}}),angular.module("resources.users",[]).factory("Users",["$http","$q","$cookieStore","SERVER_BASE_URL",function(a,b,c,d){function e(){return d+"/users"}function f(b){var c=e();return a({url:c,method:"GET",params:b})}function g(){return[{header:"Full Name",field:"fullName"},{header:"Title",field:"title"},{header:"Email",field:"email"},{header:"Institution",field:"institution"},{header:"Phone",field:"phone"},{header:"Role",field:"role"}]}return{index:f,fields:g}}]),angular.module("resources.species",[]).factory("Species",["$http","$q","$cookieStore","SERVER_BASE_URL","authentication",function(a,b,c,d,e){function f(){var a=e.currentUser;return{"Content-Type":"application/json",Accept:"application/json","X-User-Email":a.email,"X-User-Token":a.authToken}}function g(){return d+"/species"}function h(b,c){return a({url:g()+"_systematics/"+b,method:"GET",params:c})}function i(b){return a({url:d+"/stats/"+b,method:"GET"})}function j(b){var c=g();return a({url:c,method:"GET",params:b})}function k(b,c){var d=g()+"/"+b;return a({url:d,method:"GET",params:c})}function l(b){var c,d=b.url?b.url:g(),e={};return angular.isDefined(b.data.id)?(d+="/"+b.data.id,angular.isDefined(b.dirty)?angular.forEach(b.dirty,function(a){e[a]=b.data[a]}):e=b.data,c="PATCH"):(e=b.data,c="POST"),a({url:d,method:c,headers:f(),data:{species:e}})}function m(b){var c=b.url?b.url:g();return c+="/"+b.id,a({url:c,method:"DELETE"})}function n(){return[{label:"Name",field:"name"},{label:"Genus",field:"genus"},{label:"Familia",field:"familia"},{label:"Ordo",field:"ordo"},{label:"Subclassis",field:"subclassis"},{label:"Classis",field:"classis"},{label:"Subphylum",field:"subphylum"},{label:"Phylum",field:"phylum"}]}function o(){return[{value:"single",text:"Single"},{value:"group",text:"Group"}]}function p(){return[{value:"parasitic",text:"Parasitic"},{value:"mycorrhizal",text:"Mycorrhizal"},{value:"saprotrophic",text:"Saprotrophic"},{value:"parasitic-saprotrophic",text:"Parasitic-saprotrophic"},{value:"saprotrophic-parasitic",text:"Saprotrophic-parasitic"}]}function q(){return{parasitic:"Parasitic",mycorrhizal:"Mycorrhizal",saprotrophic:"Saprotrophic","parasitic-saprotrophic":"Parasitic-saprotrophic","saprotrophic-parasitic":"Saprotrophic-parasitic"}}function r(){return[{header:"Species name",field:"fullName"},{header:"Family",field:"familia"},{header:"Order",field:"ordo"},{header:"Phylum",field:"phylum"}]}return{index:j,show:k,save:l,"delete":m,systematics:n,systematicsValues:h,growthTypes:o,nutritiveGroups:p,nutritiveGroupsHash:q,fields:r,stats:i}}]),angular.module("resources.references",[]).factory("References",["$http","$q","$cookieStore","SERVER_BASE_URL","authentication",function(a,b,c,d,e){function f(){var a=e.currentUser;return{"Content-Type":"application/json",Accept:"application/json","X-User-Email":a.email,"X-User-Token":a.authToken}}function g(){return d+"/references"}function h(b){var c=g();return a({url:c,method:"GET",params:b})}function i(b,c){var d=g()+"/"+b;return a({url:d,method:"GET",params:c})}function j(b){var c,d=b.url?b.url:g(),e={};return angular.isDefined(b.data.id)?(d+="/"+b.data.id,angular.isDefined(b.dirty)?angular.forEach(b.dirty,function(a){e[a]=b.data[a]}):e=b.data,c="PATCH"):(e=b.data,c="POST"),a({url:d,method:c,headers:f(),data:{references:e}})}function k(b){var c=b.url?b.url:g();return c+="/"+b.id,a({url:c,method:"DELETE"})}function l(){return[{header:"Title",field:"title",placeholder:"Type in title"},{header:"Authors",field:"authors",placeholder:"Type in authors"},{header:"ISBN",field:"isbn",placeholder:"Type in ISBN (optional)"},{header:"URL",field:"url",placeholder:"Type in URL (optional)"}]
}return{index:h,show:i,save:j,"delete":k,fields:l}}]),angular.module("resources.characteristics",[]).factory("Characteristics",["$http","$q","$cookieStore","SERVER_BASE_URL","authentication",function(a,b,c,d,e){function f(){var a=e.currentUser;return{"Content-Type":"application/json",Accept:"application/json","X-User-Email":a.email,"X-User-Token":a.authToken}}function g(a){return d+"/species/"+a+"/characteristics"}function h(b){var c=g(b.speciesId);return angular.isDefined(b.id)&&(c+="/"+b.id,delete b.id),delete b.speciesId,a({url:c,method:"GET",params:b})}function i(b){var c,d=b.url?b.url:g(b.speciesId),e={characteristics:{}};return angular.isDefined(b.params)&&Object.keys(b.params).forEach(function(a){e[a]=b.params[a]}),angular.isDefined(b.data.id)?(d+="/"+b.data.id,angular.forEach(b.dirty,function(a){e.characteristics[a]=b.data[a]}),c="PATCH"):(e.characteristics=b.data,c="POST"),a({url:d,method:c,headers:f(),data:e})}function j(b){var c=g(b.speciesId)+"/"+b.data.id;return a({url:c,method:"DELETE"})}function k(a){return[{key:"fruitingBody",title:"Fruiting Body",locale:a[0]},{key:"microscopy",title:"Microscopy",locale:a[0]},{key:"flesh",title:"Flesh",locale:a[0]},{key:"chemistry",title:"Chemistry",locale:a[0]},{key:"notes",title:"Notes",locale:a[0]}]}function l(){return["edible","cultivated","medicinal","poisonous"]}function m(a,b){return angular.isUndefined(b)&&(b="sr"),{edible:{sr:"jestiva",en:"Edible"},cultivated:{sr:"uzgajana",en:"Cultivated"},medicinal:{sr:"lekovita",en:"Medicinal"},poisonous:{sr:"otrovna",en:"Poisonous"}}[a][b]}function n(a,b){return angular.isUndefined(b)&&(b="sr"),{fruitingBody:{sr:"plodno telo",en:"Fruiting Body"},microscopy:{sr:"mikroskopske karakteristike",en:"Microscopy"},flesh:{sr:"meso",en:"Flesh"},chemistry:{sr:"hemijska reakcija",en:"Chemistry"},notes:{sr:"napomena",en:"Notes"}}[a][b]}return{get:h,save:i,httpDelete:j,sectionsArray:k,usabilitiesArray:l,translateSection:n,translateUsability:m}}]),angular.module("directives.tableWithPagination",[]).directive("foTable",function(){var a=function(a){var b,c,d,e=a.meta,f=e.pageCount,g=e.page,h=a.paginatorPages||10,i=e.perPage||10;for(h>=f?(b=new Array(f),c=0):g>=f-i/2?(b=new Array(h),c=f-i):(b=new Array(h),c=1>=g-i/2?0:g-i/2-1),d=0;d<b.length;d++)b[d]=d+c+1;return b},b=function(a,b){b=void 0===b?{}:b;var c=a.meta,d={},e=void 0===b.page?c.page:b.page,f=void 0===b.perPage?c.perPage:b.perPage,g=void 0===b.sort?a.sort:b.sort,h=void 0===a.order?"":a.order;return e>1&&(d.page=e),10!==f&&(d.perPage=f),d.sort=h+g,d};return{templateUrl:"common/directives/table/table.tpl.html",restrict:"E",replace:!1,scope:{params:"="},link:function(c){c.$watch("params",function(){c.pageLinks=a(c.params)},!0),c.previous=function(){c.params.meta.page>1&&c.params.getData(b(c.params,{page:c.params.meta.page-1}))},c.next=function(){c.params.meta.page<c.params.meta.pageCount&&c.params.getData(b(c.params,{page:c.params.meta.page+1}))},c.getPage=function(a){c.params.getData(b(c.params,{page:a}))},c.changeOrder=function(){c.params.order="-"===c.params.order?"":"-"},c.removeRow=function(a){c.params.removeRow(a.id).success(function(){c.getPage(c.params.meta.page)})},c.params.columns.forEach(function(a){angular.isDefined(c.columns)?c.columns.push(a):c.columns=[]}),c.pageSizeChoices=void 0===c.params.pageSizeChoices?[10,25,50,100]:c.params.pageSizeChoices,c.editUrl="^"===c.params.editUrl[0]?c.params.editUrl.substring(1):c.params.editUrl,c.changeOrder=function(a){c.params.order=a,c.getPage(1)}}}}),angular.module("directives.newHabitat",["directives.habitatSpecies"]).directive("foNewHabitat",["Habitats",function(a){function b(b){if(angular.isDefined(b)&&angular.isArray(b)&&b.length>0){var c,d,e=[],f=0;return angular.forEach(b,function(b){d=Object.keys(b)[0],c={habitat:d,id:0},b[d].subhabitat&&(c.subhabitat=b[d].subhabitat),b[d].species&&(c.species=b[d].species),c.availableSpecies=a.species(c.habitat,c.subhabitat),e.push(c),f++},e),e}return[]}function c(a){var b=[];return angular.forEach(a,function(a){var c={};c[a.habitat]={},a.subhabitat&&(c[a.habitat].subhabitat=a.subhabitat),a.species&&(c[a.habitat].species=a.species),b.push(c)},b),b}return{templateUrl:"common/directives/newHabitat.tpl.html",restrict:"E",replace:!1,scope:{storeValue:"=",habitats:"="},link:function(d){d.habitatsInternal=b(d.habitats),d.$watch("newHabitat",function(){if(angular.isDefined(d.newHabitat)){var b={habitat:d.newHabitat,id:d.habitatsInternal.length,availableSpecies:a.species(d.newHabitat)};d.habitatsInternal.push(b),d.habitatsExternal=c(d.habitatsInternal),d.storeValue(d.habitatsExternal),d.editHabitat=!1,d.newHabitat=void 0}}),d.availableHabitats=a.habitats(),d.availableHabitatsHash=function(){var b={};return a.habitats().forEach(function(a){b[a.key]=a.title}),b},d.translateHabitat=a.translateHabitat,d.translateSubhabitat=a.translateSubhabitat,d.updateHabitat=function(b,e){angular.forEach(d.habitatsInternal,function(c){c.id===b&&(c.habitat=e,c.availableSpecies=a.species(c.habitat,c.subhabitat))},d.habitatsInternal),d.habitatsExternal=c(d.habitatsInternal),d.storeValue(d.habitatsExternal)},d.updateSubhabitat=function(b,e){angular.forEach(d.habitatsInternal,function(c){c.id===b&&(c.subhabitat=e,c.species=void 0,c.availableSpecies=a.species(c.habitat,c.subhabitat))},d.habitatsInternal),d.habitatsExternal=c(d.habitatsInternal),d.storeValue(d.habitatsExternal)},d.updateSpecies=function(a,b){angular.forEach(d.habitatsInternal,function(c){c.id===a&&(c.species=b)},d.habitatsInternal),d.habitatsExternal=c(d.habitatsInternal),d.storeValue(d.habitatsExternal)},d.deleteHabitat=function(a){d.habitatsInternal.splice(a,1),d.habitatsExternal=c(d.habitatsInternal),d.storeValue(d.habitatsExternal)},d.subhabitatsFor=function(b){return a.subhabitats(b)}}}}]),angular.module("directives.habitatSpecies",[]).directive("foHabitatSpecies",function(){function a(a,b){var c=[];return a.forEach(function(a){var d=!1;angular.isArray(b)&&b.forEach(function(b){b===a.key&&(d=!0)}),d||c.push(angular.copy(a))}),c}return{templateUrl:"common/directives/habitatSpecies.tpl.html",restrict:"E",replace:!1,scope:{habitat:"=",update:"="},link:function(b){b.species=function(){return void 0===b.habitat.species?[]:b.habitat.species},b.speciesLabel=function(a){var b=angular.copy(a.key);return b.charAt(0).toUpperCase()+b.slice(1)+" ("+a.value+")"},b.$watch("newSpecies",function(){angular.isDefined(b.newSpecies)&&(angular.isArray(b.habitat.species)||(b.habitat.species=[]),b.habitat.species.push(b.newSpecies),b.update(b.habitat.i,b.habitat.species),b.addSpecies=!1,b.newSpecies=void 0),b.availableSpecies=a(b.habitat.availableSpecies,b.habitat.species)}),b.deleteSpecies=function(c){b.habitat.species.splice(c,1),0===b.habitat.species.length&&(b.habitat.species=void 0),b.update(b.habitat.i,b.habitat.species),b.availableSpecies=a(b.habitat.availableSpecies,b.habitat.species)}}}}),angular.module("directives.substratesSelect",[]).directive("foSubstratesSelect",["Substrates",function(a){return{templateUrl:"common/directives/substratesSelect.tpl.html",restrict:"E",replace:!1,scope:{substrates:"="},link:function(b){void 0===b.substrates&&(b.substrates=[]),b.allSubstrates=a.substrates(),b.availableSubstrates=function(){var a=angular.copy(b.allSubstrates);return angular.isArray(b.substrates)&&b.substrates.forEach(function(b){delete a[b]}),a},b.$watch("newSubstrate",function(){angular.isDefined(b.newSubstrate)&&(b.substrates.push(b.newSubstrate),b.editSubstrate=!1,b.newSubstrate=void 0)}),b.deleteSubstrate=function(a){b.substrates.splice(a,1)}}}}]),angular.module("directives.descriptionEdit",[]).directive("foDescriptionEdit",["Characteristics","FoI18n",function(a,b){return{templateUrl:"common/directives/descriptionEdit.tpl.html",restrict:"E",replace:!1,scope:{characteristic:"="},link:function(c){c.locales=b.localesArray(),c.sections=a.sectionsArray(c.locales);var d=c.sections[0];c.active=function(a){return a===d},c.activate=function(a){d=a}}}}]),angular.module("directives.usability",[]).directive("foUsability",function(){return{templateUrl:"common/directives/usability.tpl.html",restrict:"E",replace:!1,scope:{characteristic:"=",edit:"@",showLabels:"@"},link:function(a){a.sections=[{key:"edible",title:"Edible"},{key:"cultivated",title:"Cultivated"},{key:"poisonous",title:"Poisonous"},{key:"medicinal",title:"Medicinal"}]}}}),angular.module("directives.usabilityPublic",[]).directive("foUsabilityPublic",["Characteristics",function(a){return{templateUrl:"common/directives/usabilityPublic.tpl.html",restrict:"E",replace:!1,scope:{usabilities:"=",reset:"="},link:function(b){void 0===b.usabilities&&(b.usabilities=[]),b.reset=function(){a.usabilitiesArray().forEach(function(a){b.allUsabilities[a].selected=!1})},b.allUsabilities={edible:{title:"Jestiva",selected:!1},cultivated:{title:"Uzgajana",selected:!1},poisonous:{title:"Otrovna",selected:!1},medicinal:{title:"Lekovita",selected:!1}},b.toggleUsability=function(a){var c=b.usabilities.indexOf(a);c>-1?b.usabilities.splice(c,1):b.usabilities.push(a),b.allUsabilities[a].selected=!b.allUsabilities[a].selected}}}}]),angular.module("directives.characteristicsTable",[]).directive("foCharacteristicsTable",["characteristicComponent",function(a){return{templateUrl:"common/directives/characteristicsTable.tpl.html",restrict:"E",replace:!0,scope:{parent:"@",characteristic:"=",characteristics:"=",characteristicRow:"=",deleteDialog:"=",resetDialog:"=",saveCharacteristic:"=",reset:"=",parentId:"="},link:function(b){b.isDirty=function(){return a.isDirty(b.characteristic)},"species"===b.parent?(b.parentColumnTitle="Species",b.parentValue=function(a){return a.species.fullName}):"references"===b.parent&&(b.parentColumnTitle="References",b.parentValue=function(a){return a.reference.fullTitle}),b.resetCharacteristic=function(){b.reset(),b.characteristic=void 0},b.characteristicRow={show:function(c){c=angular.isDefined(c)?c:this.pendingIndex,this.currentIndex=c,angular.isDefined(c)&&(b.isDirty()?(this.pendingIndex=c,b.resetDialog.show()):(b.reset(),b.characteristic=angular.copy(b.characteristics[c]),a.initialize(b.characteristic.id,b.characteristic),this.pendingIndex=void 0))},hide:function(a){b.isDirty()?b.resetDialog.show(a):(this.pendingIndex=void 0,b.reset(),b.characteristic=void 0)},isActive:function(a){return void 0===b.parentId&&b.characteristic&&b.characteristic.id===a},pendingIndex:void 0,currentIndex:void 0}}}}]),angular.module("directives.characteristicEdit",[]).directive("foCharacteristicEdit",["characteristicComponent",function(a){return{templateUrl:"common/directives/characteristicEdit.tpl.html",restrict:"E",replace:!1,scope:{characteristic:"="},link:function(b){b.$watch("characteristic",function(){b.firstActive=!0,b.translationMissing=a.translationMissing(b.characteristic)},!0),b.appendHabitats=function(a){b.characteristic.habitats=a},b.section={usability:{title:"Usability",helpText:"Select one or more values. Optional."},habitats:{title:"Habitats",helpText:null},substrates:{title:"Substrates",helpText:"Press and hold CTRL to select multiple."},description:{title:"Description",helpText:null}}}}}]).factory("characteristicComponent",["Characteristics","FoI18n","Util",function(a,b,c){function d(a,b,c){angular.isUndefined(a)&&(a="new"),r[a]=[],angular.isDefined(b)?(s[a]=angular.copy(b),angular.isDefined(b.species)?u[a]=b.species.id:angular.isDefined(b.links)&&angular.isDefined(b.links.species)?u[a]=b.links.species:(u[a]=b.speciesId,delete b.speciesId)):s[a]=void 0,angular.isDefined(c)&&(t[a]=c)}function e(a){a&&d(h(a))}function f(a){return a&&a.id&&(r[a.id]=[],angular.forEach(s[a.id],function(b,c){angular.isUndefined(s[a.id][c])?null!==a[c]&&r[a.id].push(c):angular.equals(s[a.id][c],a[c])||r[a.id].push(c)})),i(a)}function g(a){var b=h(a);return{url:t[b],data:a,dirty:r[b],speciesId:u[b]}}function h(a){return angular.isDefined(a.id)?a.id:"new"}function i(a){return!k(a)&&angular.isDefined(a)&&(angular.isUndefined(a.id)||r[a.id].length>0)}function j(a){var b;angular.isUndefined(a.id)?(b=void 0,["edible","cultivated","poisonous","medicinal"].forEach(function(b){a[b]===!1&&(a[b]=void 0)}),["habitats","substrates"].forEach(function(b){angular.isDefined(a[b])&&0===a[b].length&&(a[b]=void 0)})):b=null;var c;["fruitingBody","flesh","microscopy","chemistry","notes"].forEach(function(d){v(a[d])||(c=!0,["sr","en"].forEach(function(b){n(a[d][b])&&(a[d][b]=m(a,d,b)?null:void 0),c=c&&angular.isUndefined(a[d][b])}),c===!0&&(a[d]=b))})}function k(a){if(angular.isDefined(a)&&(j(a),angular.isUndefined(a.id))){var b=!0;return angular.forEach(a,function(a,c){"referenceId"!==c&&angular.isDefined(a)&&(b=!1)}),b}return!1}function l(a){return angular.isDefined(a)&&angular.isDefined(a.id)}function m(a,b,c){return l(a)&&null!==s[a.id][b]&&angular.isDefined(s[a.id][b][c])}function n(a){return angular.isUndefined(a)||null===a||0===a.length}function o(c){var d=[];if(angular.isDefined(c)){var e,f=b.localesArray();a.sectionsArray(f).forEach(function(a){c[a.key]&&(e={},e[a.key]=[],f.forEach(function(b){angular.isUndefined(c[a.key][b.key])&&e[a.key].push(b.title)}),e[a.key].length>0&&d.push(e))})}return d}function p(){var a=["habitats","substrates","flesh","microscopy","chemistry","fruitingBody"];return a}function q(b){var c=g(b);return c.params={respondWithBody:!0},a.save(c).then(function(a){return a.data.characteristics})}var r={},s={},t={},u={},v=c.undefinedOrNull;return{initialize:d,reset:e,trackChanges:f,getAttrs:g,isDirty:i,emptyParams:k,clean:j,translationMissing:o,missingCharacteristics:p,saveCharacteristic:q}}]),angular.module("directives.characteristicPreview",[]).directive("foCharacteristicPreview",["FoI18n","Characteristics",function(a,b){return{templateUrl:"common/directives/characteristicPreview.tpl.html",restrict:"E",replace:!1,scope:{characteristic:"="},link:function(c){c.showUsability=c.characteristic.edible||c.characteristic.cultivated||c.characteristic.poisonous||c.characteristic.medicinal,c.usabilities=b.usabilitiesArray(),c.descriptions=[],c.locales=a.localesArray(),c.sections=b.sectionsArray(c.locales),c.descriptions=[];var d;c.sections.forEach(function(a){c.characteristic[a.key]&&(d=[],c.locales.forEach(function(b){angular.isUndefined(c.characteristic[a.key][b.key])&&d.push(b.title)}),c.descriptions.push({section:a,localesMissing:d}))})}}}]),angular.module("directives.typeahead",[]).directive("foTypeahead",function(){return{templateUrl:"common/directives/typeahead.tpl.html",restrict:"E",replace:!1,scope:{id:"=",value:"=",properties:"="},link:function(a){a.select=function(b){a.id=b.id}}}}),angular.module("directives.icon",[]).directive("foIcon",["icons",function(a){return{templateUrl:"common/directives/icon.tpl.html",restrict:"E",replace:!0,scope:{icon:"@",klass:"@"},link:function(b){b.iconClass=b.klass?b.klass:"fa fw",b.iconClass+=" "+a.get(b.icon)}}}]),angular.module("directives.helpText",[]).directive("foHelpText",function(){return{templateUrl:"common/directives/helpText.tpl.html",restrict:"E",replace:!0,scope:{text:"@"},link:function(a){a.expand=!1}}}),angular.module("directives.alert",[]).directive("foAlert",function(){return{templateUrl:"common/directives/alert.tpl.html",restrict:"E",replace:!1,transclude:!0,scope:{type:"@",title:"@",notDismissable:"="},link:function(a){a.danger?(a.type="danger",a.title=a.title||"Danger"):a.warning?(a.type="warning",a.title=a.title||"Warning"):a.info?(a.type="info",a.title=a.title||"Info"):a.success&&(a.type="success",a.title=a.title||"Success")}}}),angular.module("directives.systematicsTypeAhead",[]).directive("foSystematicsTypeAhead",["Species",function(a){return{templateUrl:"common/directives/systematicsTypeAhead.tpl.html",restrict:"E",replace:!0,scope:{systematics:"=",systematicsCategory:"="},link:function(b){b.systematicsCategory="genus",b.allSystematics=[{key:"fullName",value:"vrsta"},{key:"genus",value:"rod"},{key:"familia",value:"familija"},{key:"ordo",value:"red"},{key:"subclassis",value:"podklasa"},{key:"classis",value:"klasa"},{key:"subphylum",value:"podfilum"},{key:"phylum",value:"filum"}],b.$watch("systematicsCategory",function(a){b.allSystematics.forEach(function(c){c.key===a&&(b.systematicsCategoryLabel=c.value)}),b.systematics=void 0}),b.typeAheadProperties={icon:"species",key:"value",placeholder:"",getData:function(c){return a.systematicsValues(b.systematicsCategory,{value:c}).then(function(a){return a.data.systematics})}}}}}]);